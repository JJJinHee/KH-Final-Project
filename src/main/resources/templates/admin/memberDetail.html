<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <!-- 폰트  -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">
    <!-- 공통 css -->
    <link type="text/css" rel="stylesheet" href="/css/common.css">
    <!-- 나현 css (메인, 관리자)-->
    <link type="text/css" rel="stylesheet" href="/css/nh.css">
    <link type="text/css" rel="stylesheet" href="/css/adminMain.css">
    <!-- 자바스크립트 -->
    <script type="text/javascript" src="/js/common.js"></script> 

    <title>다나은 관리자|회원관리</title>
</head>	
<body>
 <div th:replace="fragments/adminMenu.html :: fragment-nav(currnet='1')"></div>
             <!-- 내용 부분 : admincontent-main 안에 작성 -->
            <div class="admincontent-main">
                <div class="infowrap">
                    <h3 class="pagetitle">회원 정보 관리</h3>
                    <div class="member-info-area">
                        <img src="/images/admin/member_manage.png">
                        <h3 th:text="${member.id}"></h3>
                    </div>
                </div>
                    <div class="content-wrap2">
                        <div class="contentitem">
                            <h3>회원정보</h3>
                            <div class="text-area">
                                <h4>이름</h4>
                                <input type="text" name="name" th:value="${member.name}" readonly>
                            </div>
                            <div class="text-area">
                                <h4>이메일</h4>
                                <input type="text" class="iptstyle2" name="email" th:value="${member.email}" readonly>
                            </div>
                            <div class="text-area">
                                <h4>전화번호</h4>
                                <input type="text" name="phone" th:value="${member.phone}" readonly>
                            </div>
                            <div class="text-area">
                                <h4>주소</h4>
                                <input type="text" class="iptstyle2" name="address" th:value="${member.address}" readonly>
                            </div>
                            <div class="text-area">
                                <h4>회원상태</h4>
                                <select name="accSecssionYn" th:value="${member.accSecssionYn}" disabled>
                                    <option value="N" th:selected="${member.accSecssionYn} == 'N'">회원</option>
                                    <option value="Y" th:selected="${member.accSecssionYn} == 'Y'">회원탈퇴</option>
                                </select>
                            </div>
                            <div class="text-area">
                                <h4>가입일</h4>
                                <input type="text" name="enrollDatetime" th:value="${#dates.format(member.enrollDatetime, 'yyyy-MM-dd')}" readonly>
                            </div>
                            <!-- 탈퇴상태인 경우만 탈퇴사유 칸 생성-->
                            <th:block th:if="${member.accSecssionYn} == 'Y'">
                            <div class="text-area">
                                <h4>탈퇴사유</h4>
                                <input th:if="${not #strings.isEmpty(member.accSecessionReason)}" type="text" name="accSecessionReason" th:value="${member.accSecessionReason}" readonly>
                                <input th:if="${#strings.isEmpty(member.accSecessionReason)}" type="text" name="accSecessionReason" value="없음" readonly>
                            </div>
                            <div class="text-area">
                                <h4>개선 요구사항</h4>
                                <input th:if="${not #strings.isEmpty(member.otherOpinions)}" type="text" name="otherOpinions" th:value="${member.otherOpinions}" readonly>
                                <input th:if="${#strings.isEmpty(member.otherOpinions)}" type="text" name="otherOpinions" value="없음" readonly>
                            </div>
                            <div class="text-area">
                                <h4>탈퇴일</h4>
                                <input type="text" name="accSecssionDatetime" th:value="${#dates.format(member.accSecssionDatetime, 'yyyy-MM-dd')}" readonly>
                            </div>
                            </th:block>
                        </div>

                        <div class="contentitem">
                            <h3>반려견 정보</h3>
                            <div class="text-area">
                                <h4>이름</h4>
                                <input type="text" name="dog.name" th:value="${member.dog.name}" readonly>
                            </div>
                            <div class="text-area">
                                <h4>성별</h4>
                                <select name="dog.gender" th:value="${member.dog.gender}" disabled>
                                    <option value="암컷" th:selected="${member.dog.gender} == '암컷'">암컷</option>
                                    <option value="수컷" th:selected="${member.dog.gender} == '수컷'">수컷</option>
                                </select>
                            </div>
                            <div class="text-area">
                                <h4>나이</h4>
                                <input type="text" name="dog.age" th:value="${member.dog.age}" readonly>
                            </div>
                            <div class="text-area">
                                <h4>견종</h4>
                                <input type="text" name="dog.breed" th:value="${member.dog.breed}" readonly>
                            </div>
                            <div class="text-area">
                                <h4>중성화 유무</h4>
                                <select name="dog.neuteredStatus" th:value="${member.dog.neuteredStatus}" disabled>
                                    <option value="예" th:selected="${member.dog.neuteredStatus} == '예'">예</option>
                                    <option value="아니오" th:selected="${member.dog.neuteredStatus} == '아니오'">아니오</option>
                                    <option value="모름" th:selected="${member.dog.neuteredStatus} == '모름'">모름</option>
                                </select>
                            </div>
                        </div>
                    </div>
                     <div class="content-wrap cs1">
                        <h3>예약내역</h3>
                        <table class="tblstyle tbw">
                            <colgroup>
                                <col width="15%">
                                <col width="15%">
                                <col width="15%">
                                <col width="15%">
                                <col width="40%">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th>예약일</th>
                                    <th>예약 시간</th>
                                    <th>진료 과목</th>
                                    <th>반려견 이름</th>
                                    <th>증상</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- 예약내역이 없는 경우 i-->
                                <th:block th:if="${#lists.isEmpty(member.reservation)}">
                                <tr class="colored2">
                                	<td colspan="5">예약 내역이 없습니다.</td>
                                </tr>
                                </th:block>
                                <!-- 예약내역 있는 경우 -->
                            	<th:block th:if="${not #lists.isEmpty(member.reservation)}">
                                <tr class="colored2" th:each="res : ${member.reservation}" th:onclick="|javascript:viewLayer('${res.reservationNo}, ${member.no}'), viewLayer2('${res.reservationNo}')|">
                                    <td th:text="${#dates.format(res.reservationDate, 'yyyy.MM.dd')}"></td>
                                    <td th:text="${res.reservationTime}"></td>
                                    <th:block th:switch="${res.tNo}">
	                                	<td th:case="1">내과</td>	
	                                	<td th:case="2">외과</td>
	                                	<td th:case="3">안과</td>
	                                	<td th:case="4">정형외과</td>                           	
	                           		</th:block>
                                    <td th:text="${res.dog.name}"></td>
                                    <td th:text="${res.symptom}" class="contentstyle"></td>
                                </tr>
                                </th:block>
                            </tbody>
                        </table>
                    </div> 
                    <!-- 유효성 검사 후 버튼 활성화 : btn-b , 비활성화 : btn-disabled -->
                    <div class="btnarea2">
                        <button class="btn-b">회원 정보 수정</button>
                        <button class="btn-c btns" type="button" onclick="">회원 삭제</button>
                    </div>
            </div>
        </div>
    </div>
    
    <!-- 레이어팝업 -->
    <div id="pop">
        <div class="popcontent">
            <div class="innercont2">
                <div class="res-state">
                    <p>예약완료</p>
                </div>
            </div>
            <div class="innercont">
                <div class="text-area2">
                    <p>예약일</p>
                    <input type="text" name="" id="" value="2020.12.12" disabled>
                </div>
                <div class="text-area2">
                    <p>예약시간</p>
                    <input type="text" name="" id="" value="10:00" disabled>
                </div>
            </div>
            <div class="innercont">
                <div class="text-area2">
                    <p>진료과목</p>
                    <input type="text" name="" id="" value="내과" disabled>
                </div>
                <div class="text-area2">
                    <p>담당 수의사</p>
                    <input type="text" name="" id="" value="김소민" disabled>
                </div>
            </div>
            <div class="innercont2">
                <div class="text-area2">
                    <p class="textsyl">진료 대상</p>
                    <span>흰둥이</span>&nbsp;&nbsp;<span>4살</span>&nbsp;&nbsp;<span>암컷</span>
                </div>
            </div>
            <div class="innercont2">
                <div class="text-area2">
                    <p>증상</p>
                    <textarea type="text" name="" id="" value="흰둥이, 5살, 암컷" disabled></textarea>
                </div>
            </div>

        </div>
        <button class="btn_close" type="button" onclick="closeLayer();">Close</button>
    </div>
    
    
    <script>
	    function viewLayer(rno, userNo){
	        $('#pop').css('display', 'block');
	        
	        $.ajax({
	        	url : "/admin/member/detail/" + rno + "/" + userNo,
	        	type : "get",
	        	dataType : "json",
	        	success : function(data){
	        		console.log(data);
	        	},
	        	error : function(e){
	        		console.log(e);
	        	}
	        });
	
	    }
	    
	    function closeLayer(){
            $('#pop').css('display', 'none');
        } 
    	
	    // restful로 데이터 가져오기
    	function viewLayer2(no){
    		console.log(no + "2");
    	}
    </script>
 
</body>
</html>